TITLE: KirikiriZ 向け互換デバッグユーザインターフェースウィンドウ
AUTHOR: 合資会社ワムソフト 三上 響

●これは何か？

吉里吉里２に存在したデバッグ系のウィンドウ類を
win32dialog.dll にて実装したものになります。

下記が実装されています。

	・コンソールウィンドウ（Debug.console）
	・スクリプトエディタ（Shift+F2で表示されるもの）
	・Padクラス（一部プロパティについては未サポート）

下記は未実装ですが，今後対応するかもしれません。

	・コントローラ（Debug.controller）
	・監視式ウィンドウ（Shift+F3で表示されるもの）

なお，各動作について細部まで厳密にチェックはしていません。
問題があった場合は issue 登録をお願いします。


●ファイルの内容について

00README.txt		このファイルです
data			テストスクリプトフォルダです
data/startup.tjs	テストスクリプト起動用TJSファイルです
data/win32dialog.tjs	win32dialog.dllのヘルパーTJSです
data/k2debugui.tjs	互換コンソールウィンドウの本体です

	※いずれのtjsファイルも UTF16LE-BOM エンコードのため，
	  -readencodingオプションがUTF-8でもShift_JISでも読み込めます

●動作確認方法

動作確認には足りないファイルを用意していただく必要があります。

tvpwin32.exe		デバッグログ周りが拡張された最新版を使用してください
plugin/menu.dll		テストスクリプトの動作確認をする場合に必要です
plugin/win32dialog.dll	吉里吉里本家レポジトリからバイナリを取得してください
			⇒ https://sv.kikyou.info/svn/kirikiri2/trunk/kirikiri2/bin/win32/plugin/win32dialog.dll

上記ファイルを置いて起動していただくと，
テストウィンドウと共にコンソールが表示されます。


●使い方

startup.tjs などに

	Scripts.evalStorage("k2debugui.tjs");

とすることで Debug.console と Pad クラスが使用できるようになります。

コマンドラインオプションで「-debugwin=no」が指定されていた場合は，
Debug.console.visibleを無視するダミーのコンソールオブジェクトが生成されます。


●互換性について

▽全般：

・Shift+F? などのホットキーでのデバッグウィンドウ類の表示ON/OFFは機能しません。
　Window.onKeyDown などに表示を切り替えるような細工を入れてください。

・現在，krenvprf.kep相当のデバッグウィンドウ位置等の保存機能がありません。
　別の形式で状態を保存するような対応を検討中です。

・デバッグウィンドウ上での右クリックメニューの特殊機能はありません。

・ウィンドウのアイコンが違います。

・テキストの選択範囲の色が違います。

・個別のデバッグウィンドウを最小化した時に
　タスクバーではなく画面左下にストックされます。

・Windowを１つでも作る前(Window.mainWindowがない状態)で
　コンソール等のデバッグウィンドウを表示すると，
　後からWindowを作って表示した場合に，Window側の最小化ボタンが
　各デバッグウィンドウの最小化と連動しません。
　また，タスクバーのボタンも個別の枠を取る状態になります。
＞デバッグウィンドウの親ウィンドウが無いために起こる現象で，仕様です。

・逆にWindow.mainWindowがある状態でデバッグウィンドウを表示すると，
　そのウィンドウは常にWindow.mainWindowより手前に表示されてしまいます。
＞設定で回避できないか確認中（TVPApplicationWindowが無くなったことの弊害？）


▽コンソール：

・現状，下部１行入力のヒストリ機能がありません。
＞対応検討中。

・連続したログの出力はアイドル状態になってからまとめて一括で表示されます。
＞スクロールで流れるログを見たい場合は別途cmd.exeなどを使用してください

・１行入力のeval処理の結果表示が若干異なります。
＞結果がObjectの場合に詳細情報が表示されます

・１行入力を評価した時に例外が発生した場合，入力欄がクリアされません。
＞修正を前提とした動作になっています

・ログテキスト側をクリックすると１行入力からフォーカスが外れて
　ログ側にキャレットが表示されてしまいます。(Tabキーで復帰できます）

・ログがスクロールする時に表示がチラ付く場合があります

・ログの上限行数が異なります


▽Padクラス：

・ステータスバーにカーソル位置(X:Y)の表示機能はありません

・下記プロパティは new Pad() した後，visible=trueする間にのみ変更可能です。
　一度表示した後からの変更はできません。

	fontFace
	fontSize, fontHeight
	fontBold
	wordWrap

・fontHeightプロパティは恐らく画面のDPIを変更した環境では
　正しいピクセルサイズを指定できません。また負数も指定できません。
　代わりにfontSizeプロパティを使用してください。

・下記プロパティは未サポートです。（値は設定できますが意味を持ちません）

	fileName
	fontItalic
	fontUnderline
	fontStrikeOut

・visibleをtrue->false->trueとした場合にキャレット位置が失われて
　テキストが全選択状態になってしまいます。


▽スクリプトエディタ

・Padクラスに左下の実行ボタンを有効にしたバージョンのクラスが
  「ScriptEditorPad」クラスとして実装されています。

・現状，例外発生時に自動でスクリプトエディタを自動で表示してエラー行に
　カーソルをあわせる機能はありません。
＞Exceptionクラスにエラー位置などの情報がないため，本体側の対応を検討中


